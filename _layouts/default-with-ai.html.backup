<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google Tag Manager -->
    {% if site.google_tag_manager %}
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','{{ site.google_tag_manager }}');</script>
    {% endif %}
    <!-- End Google Tag Manager -->

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% if page.title %}{{ page.title }} | {% endif %}{{ site.title }}</title>
    <meta name="description" content="{% if page.description %}{{ page.description }}{% else %}{{ site.description }}{% endif %}">

    <link rel="stylesheet" href="{{ '/assets/css/main.css' | relative_url }}">
    <link rel="canonical" href="{{ page.url | replace:'index.html','' | absolute_url }}">

    {% seo %}
    {% feed_meta %}
    {% include structured-data.html %}

    <!-- Google Analytics -->
    {% if site.google_analytics %}
    <script async src="https://www.googletagmanager.com/gtag/js?id={{ site.google_analytics }}"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', '{{ site.google_analytics }}');
    </script>
    {% endif %}
    <!-- End Google Analytics -->
</head>
<body>
    <!-- Google Tag Manager (noscript) -->
    {% if site.google_tag_manager %}
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id={{ site.google_tag_manager }}"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    {% endif %}
    <!-- End Google Tag Manager (noscript) -->
    {% include header.html %}

    <main>
        {{ content }}
    </main>

    {% include footer.html %}

    <!-- Custom Abba AI Chat Widget -->
    <div id="abba-chat-widget" class="chat-widget">
        <button id="chat-toggle" class="chat-toggle" aria-label="Open Abba AI Chat">
            <svg class="chat-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
            </svg>
            <svg class="close-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: none;">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        </button>

        <div id="chat-window" class="chat-window" style="display: none;">
            <div class="chat-header">
                <div class="chat-avatar">
                    <div class="avatar-circle">
                        <span class="avatar-text">AI</span>
                    </div>
                </div>
                <div class="chat-title">
                    <h3>Abba AI</h3>
                    <p>Your AI automation assistant</p>
                </div>
            </div>

            <div id="chat-messages" class="chat-messages">
                <div class="message bot-message">
                    <div class="message-content">
                        <p>Hello! I'm Abba AI, your intelligent assistant. I can help you learn about:</p>
                        <div class="quick-questions">
                            <button class="quick-question" data-question="How does AI-human collaboration work?">ü§ù AI-Human Collaboration</button>
                            <button class="quick-question" data-question="What services does Abba Baba offer?">üõ†Ô∏è Our Services</button>
                            <button class="quick-question" data-question="Tell me about the Riddlen platform">üåê Riddlen Platform</button>
                            <button class="quick-question" data-question="How can AI automation help my business?">üìà Business Automation</button>
                        </div>
                    </div>
                </div>
            </div>

            <form id="chat-form" class="chat-input-form">
                <div class="chat-input-container">
                    <input
                        type="text"
                        id="chat-input"
                        class="chat-input"
                        placeholder="Ask about AI automation, services, or Riddlen..."
                        autocomplete="off"
                    >
                    <button type="submit" class="chat-send" aria-label="Send message">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="22" y1="2" x2="11" y2="13"></line>
                            <polygon points="22,2 15,22 11,13 2,9"></polygon>
                        </svg>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Custom Abba AI Chat Widget
        class AbbaAIChat {
            constructor() {
                this.chatToggle = document.getElementById('chat-toggle');
                this.chatWindow = document.getElementById('chat-window');
                this.chatMessages = document.getElementById('chat-messages');
                this.chatForm = document.getElementById('chat-form');
                this.chatInput = document.getElementById('chat-input');
                this.chatIcon = document.querySelector('.chat-icon');
                this.closeIcon = document.querySelector('.close-icon');
                this.isOpen = false;
                // WARNING: API keys in client-side code are visible to users
                // For production, use server-side proxy or serverless functions
                this.apiKey = '{{ site.openai_api_key }}' || '{{ site.claude_api_key }}';
                this.apiProvider = '{{ site.ai_provider | default: "openai" }}';

                this.init();
            }

            init() {
                this.chatToggle.addEventListener('click', () => this.toggleChat());
                this.chatForm.addEventListener('submit', (e) => this.handleSubmit(e));

                // Quick question buttons
                document.addEventListener('click', (e) => {
                    if (e.target.classList.contains('quick-question')) {
                        const question = e.target.dataset.question;
                        this.sendMessage(question);
                    }
                });

                // ESC key to close
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && this.isOpen) {
                        this.toggleChat();
                    }
                });
            }

            toggleChat() {
                this.isOpen = !this.isOpen;

                if (this.isOpen) {
                    this.chatWindow.style.display = 'flex';
                    this.chatIcon.style.display = 'none';
                    this.closeIcon.style.display = 'block';
                    this.chatInput.focus();
                } else {
                    this.chatWindow.style.display = 'none';
                    this.chatIcon.style.display = 'block';
                    this.closeIcon.style.display = 'none';
                }
            }

            async handleSubmit(e) {
                e.preventDefault();
                const message = this.chatInput.value.trim();
                if (!message) return;

                this.sendMessage(message);
            }

            async sendMessage(message) {
                // Add user message
                this.addMessage(message, 'user');
                this.chatInput.value = '';

                // Show typing indicator
                const typingId = this.addTypingIndicator();

                try {
                    const response = await this.callAI(message);
                    this.removeMessage(typingId);
                    this.addMessage(response, 'bot');
                } catch (error) {
                    this.removeMessage(typingId);
                    this.addMessage("I'm having trouble connecting right now. Please try again or contact us directly through our contact page.", 'bot');
                }
            }

            async callAI(message) {
                // Use real API if key is available, otherwise fallback to contextual responses
                if (this.apiKey && this.apiKey !== '' && this.apiKey.length > 10) {
                    try {
                        if (this.apiProvider === 'openai') {
                            return await this.callOpenAI(message);
                        } else if (this.apiProvider === 'claude') {
                            return await this.callClaude(message);
                        }
                    } catch (error) {
                        console.error('API call failed:', error);
                        // Fallback to contextual response
                    }
                }
                return this.getContextualResponse(message);
            }

            async callOpenAI(message) {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 30000); // 30 second timeout

                try {
                    const response = await fetch('https://api.openai.com/v1/chat/completions', {
                        method: 'POST',
                        signal: controller.signal,
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${this.apiKey}`
                        },
                    body: JSON.stringify({
                        model: 'gpt-3.5-turbo',
                        messages: [
                            {
                                role: 'system',
                                content: `You are Abba AI, the intelligent assistant for Abba Baba - a pioneering AI-human collaboration company.

Company Overview:
- Abba Baba specializes in AI-human collaboration through workflow automation, marketing innovation, and Web3 solutions
- Our mission: Get your time back through intelligent automation
- We believe AI should enhance human capabilities, not replace them

Key Services:
1. Workflow Automation - Streamline business processes to reclaim time
2. Marketing Automation - Automated social engagement and marketing campaigns
3. AI Integration - Help companies discover creative AI applications
4. Riddlen Platform - Web3 riddle game with human oracle network for AI validation

Riddlen Details:
- AI generates riddles, humans validate and curate
- Cross-chain oracle setup for enterprise data validation
- Complete open-source, gasless crypto ecosystem
- Combines AI generation with human verification

Brand Voice: Professional yet approachable, innovation-focused, human-centric, empowering. Always focus on how we give time and freedom back to business owners.

Keep responses concise, helpful, and focused on our services. Encourage users to contact us for consultations.`
                            },
                            {
                                role: 'user',
                                content: message
                            }
                        ],
                        max_tokens: 300,
                        temperature: 0.7
                    })
                });

                    clearTimeout(timeoutId);

                    if (!response.ok) {
                        const errorText = await response.text();
                        console.error('OpenAI API Error:', response.status, errorText);
                        throw new Error(`API request failed: ${response.status}`);
                    }

                    const data = await response.json();
                    return data.choices[0].message.content;
                } catch (error) {
                    clearTimeout(timeoutId);
                    console.error('OpenAI API call failed:', error);
                    throw error;
                }
            }

            async callClaude(message) {
                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${this.apiKey}`,
                        'anthropic-version': '2023-06-01'
                    },
                    body: JSON.stringify({
                        model: 'claude-3-haiku-20240307',
                        max_tokens: 300,
                        system: `You are Abba AI, the intelligent assistant for Abba Baba - a pioneering AI-human collaboration company.

Company Overview:
- Abba Baba specializes in AI-human collaboration through workflow automation, marketing innovation, and Web3 solutions
- Our mission: Get your time back through intelligent automation
- We believe AI should enhance human capabilities, not replace them

Key Services:
1. Workflow Automation - Streamline business processes to reclaim time
2. Marketing Automation - Automated social engagement and marketing campaigns
3. AI Integration - Help companies discover creative AI applications
4. Riddlen Platform - Web3 riddle game with human oracle network for AI validation

Riddlen Details:
- AI generates riddles, humans validate and curate
- Cross-chain oracle setup for enterprise data validation
- Complete open-source, gasless crypto ecosystem
- Combines AI generation with human verification

Brand Voice: Professional yet approachable, innovation-focused, human-centric, empowering. Always focus on how we give time and freedom back to business owners.

Keep responses concise, helpful, and focused on our services. Encourage users to contact us for consultations.`,
                        messages: [
                            {
                                role: 'user',
                                content: message
                            }
                        ]
                    })
                });

                if (!response.ok) {
                    throw new Error('API request failed');
                }

                const data = await response.json();
                return data.content[0].text;
            }

            getContextualResponse(message) {
                const lowerMessage = message.toLowerCase();

                if (lowerMessage.includes('service') || lowerMessage.includes('what do you do')) {
                    return "Abba Baba specializes in AI-human collaboration through three main services:\n\nüîÑ **Workflow Automation** - Streamline your business processes\nüéØ **Marketing Automation** - Scale your outreach intelligently\nüåê **Riddlen Platform** - Our Web3 AI validation network\n\nWould you like to learn more about any of these areas?";
                }

                if (lowerMessage.includes('riddlen') || lowerMessage.includes('web3')) {
                    return "Riddlen is our flagship Web3 platform that combines AI generation with human validation! üåê\n\n‚ú® **How it works:**\n- AI generates riddles and content\n- Human oracles validate and curate\n- Gasless blockchain transactions\n- Rewards for quality validation\n\nIt's a perfect example of AI + Human collaboration in action. Want to learn more about how you could participate?";
                }

                if (lowerMessage.includes('collaboration') || lowerMessage.includes('ai human')) {
                    return "AI-Human collaboration is at the heart of everything we do! ü§ù\n\n**Our Philosophy:**\n- AI handles repetitive tasks\n- Humans provide creativity & judgment\n- Together we achieve more than either could alone\n\n**Benefits:**\n- Preserve human agency\n- Amplify capabilities\n- Maintain quality control\n- Scale intelligently\n\nThis approach ensures AI enhances rather than replaces human expertise. How can we help you implement this in your business?";
                }

                if (lowerMessage.includes('automation') || lowerMessage.includes('help my business')) {
                    return "AI automation can transform your business in several ways: üìà\n\nüöÄ **Immediate Benefits:**\n- Free up 20-40% of your time\n- Reduce manual errors\n- Scale without proportional costs\n- Improve customer response times\n\nüí° **Common Use Cases:**\n- Customer service automation\n- Content generation & curation\n- Data processing & analysis\n- Lead qualification\n\nWant to discuss your specific automation opportunities? I'd recommend scheduling a free consultation with our team!";
                }

                if (lowerMessage.includes('contact') || lowerMessage.includes('consultation') || lowerMessage.includes('get started')) {
                    return "Great! I'd love to connect you with our team. üéØ\n\n**Next Steps:**\n1. Visit our [Contact Page](/contact) for immediate assistance\n2. Schedule a free consultation to discuss your specific needs\n3. We'll analyze your automation opportunities\n\n**What we'll cover:**\n- Assessment of current processes\n- Automation roadmap\n- ROI projections\n- Implementation timeline\n\nReady to transform your business with AI-human collaboration?";
                }

                // Default response
                return `Thanks for your question! I'm here to help you learn about Abba Baba's AI automation services, our human-AI collaboration approach, and the Riddlen platform.\n\nFor detailed answers or to discuss your specific needs, I'd recommend:\n- Exploring our [Services page](/services)\n- Reading our [FAQ](/faq)\n- Contacting our team directly\n\nWhat would you like to know more about?`;
            }

            addMessage(content, type) {
                const messageId = 'msg-' + Date.now();
                const messageEl = document.createElement('div');
                messageEl.id = messageId;
                messageEl.className = `message ${type}-message`;

                messageEl.innerHTML = `
                    <div class="message-content">
                        <p>${content.replace(/\n/g, '<br>')}</p>
                    </div>
                `;

                this.chatMessages.appendChild(messageEl);
                this.scrollToBottom();
                return messageId;
            }

            addTypingIndicator() {
                const typingId = 'typing-' + Date.now();
                const typingEl = document.createElement('div');
                typingEl.id = typingId;
                typingEl.className = 'message bot-message typing';

                typingEl.innerHTML = `
                    <div class="message-content">
                        <div class="typing-indicator">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                    </div>
                `;

                this.chatMessages.appendChild(typingEl);
                this.scrollToBottom();
                return typingId;
            }

            removeMessage(messageId) {
                const messageEl = document.getElementById(messageId);
                if (messageEl) {
                    messageEl.remove();
                }
            }

            scrollToBottom() {
                this.chatMessages.scrollTop = this.chatMessages.scrollHeight;
            }
        }

        // Initialize chat widget when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            new AbbaAIChat();
        });
    </script>

    <script src="{{ '/assets/js/main.js' | relative_url }}"></script>
</body>
</html>