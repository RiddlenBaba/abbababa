<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google Tag Manager -->
    {% if site.google_tag_manager %}
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','{{ site.google_tag_manager }}');</script>
    {% endif %}
    <!-- End Google Tag Manager -->

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% if page.title %}{{ page.title }} | {% endif %}{{ site.title }}</title>
    <meta name="description" content="{% if page.description %}{{ page.description }}{% else %}{{ site.description }}{% endif %}">

    <link rel="stylesheet" href="{{ '/assets/css/main.css' | relative_url }}">
    <link rel="canonical" href="{{ page.url | replace:'index.html','' | absolute_url }}">

    {% seo %}
    {% feed_meta %}
    {% include structured-data.html %}

    <!-- Google Analytics -->
    {% if site.google_analytics %}
    <script async src="https://www.googletagmanager.com/gtag/js?id={{ site.google_analytics }}"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', '{{ site.google_analytics }}');
    </script>
    {% endif %}
    <!-- End Google Analytics -->
</head>
<body>
    <!-- Google Tag Manager (noscript) -->
    {% if site.google_tag_manager %}
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id={{ site.google_tag_manager }}"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    {% endif %}
    <!-- End Google Tag Manager (noscript) -->
    {% include header.html %}

    <main>
        {{ content }}
    </main>

    {% include footer.html %}

    <!-- Custom Abba AI Chat Widget -->
    <div id="abba-chat-widget" class="chat-widget">
        <button id="chat-toggle" class="chat-toggle" aria-label="Open Abba AI Chat">
            <svg class="chat-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
            </svg>
            <svg class="close-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: none;">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        </button>

        <div id="chat-window" class="chat-window" style="display: none;">
            <div class="chat-header">
                <div class="chat-avatar">
                    <div class="avatar-circle">
                        <span class="avatar-text">AI</span>
                    </div>
                </div>
                <div class="chat-title">
                    <h3>Abba AI</h3>
                    <p>Enterprise AI Solutions</p>
                </div>
                <button type="button" class="chat-close" onclick="AbbaChat.toggleChat()" aria-label="Close chat">√ó</button>
            </div>

            <div id="chat-messages" class="chat-messages">
                <div class="message bot-message">
                    <div class="message-content">
                        <p>Welcome. I'm Abba AI, here to discuss how our enterprise AI-human collaboration solutions can drive measurable ROI for your organization.</p>
                        <p>Which area would you like to explore?</p>
                        <div class="quick-questions">
                            <button class="quick-question" data-question="What ROI can I expect from automation?">üìä ROI & Business Impact</button>
                            <button class="quick-question" data-question="How does the Mycelium network work?">üîó Cross-Departmental Intelligence</button>
                            <button class="quick-question" data-question="Tell me about your automation approach">‚öôÔ∏è Implementation Strategy</button>
                            <button class="quick-question" data-question="What makes your AI validation different?">‚úÖ Enterprise AI Validation</button>
                            <button class="quick-question" data-question="I need a business assessment">üéØ Schedule Discovery Call</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Contact info collection form (initially hidden) -->
            <div id="contact-form" class="contact-collection" style="display: none;">
                <div class="contact-header">
                    <button type="button" class="contact-close" onclick="AbbaChat.skipContactForm()" aria-label="Close contact form">√ó</button>
                    <div class="emoji-wave">üëã</div>
                    <h4>I'd love to introduce you to our team!</h4>
                    <p>Share a few quick details and we'll send you personalized AI automation ideas for your business. No spam, just valuable insights! ‚ú®</p>
                </div>
                <form id="contact-details-form" class="contact-details-form">
                    <div class="form-group">
                        <label class="form-label">üëã What should we call you?</label>
                        <input type="text" id="user-name" placeholder="Your first name" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">üìß Where can we reach you?</label>
                        <input type="email" id="user-email" placeholder="your@email.com" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">üè¢ What company are you with?</label>
                        <input type="text" id="user-company" placeholder="Your awesome company (optional)">
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn-primary">
                            <span class="btn-icon">üöÄ</span>
                            Get my personalized recommendations
                        </button>
                        <button type="button" class="btn-secondary" onclick="AbbaChat.skipContactForm()">
                            Maybe later, let's keep chatting
                        </button>
                    </div>
                </form>
                <div class="trust-indicators">
                    <div class="trust-item">
                        <span class="trust-icon">üîí</span>
                        <span class="trust-text">Your info is safe with us</span>
                    </div>
                    <div class="trust-item">
                        <span class="trust-icon">‚ö°</span>
                        <span class="trust-text">Quick 5-minute response</span>
                    </div>
                    <div class="trust-item">
                        <span class="trust-icon">üí°</span>
                        <span class="trust-text">Custom automation ideas</span>
                    </div>
                </div>
            </div>

            <form id="chat-form" class="chat-input-form">
                <div class="chat-input-container">
                    <input
                        type="text"
                        id="chat-input"
                        class="chat-input"
                        placeholder="Ask about AI automation, services, or Riddlen..."
                        autocomplete="off"
                    >
                    <button type="submit" class="chat-send" aria-label="Send message">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="22" y1="2" x2="11" y2="13"></line>
                            <polygon points="22,2 15,22 11,13 2,9"></polygon>
                        </svg>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Custom Abba AI Chat Widget
        class AbbaAIChat {
            constructor() {
                this.chatToggle = document.getElementById('chat-toggle');
                this.chatWindow = document.getElementById('chat-window');
                this.chatMessages = document.getElementById('chat-messages');
                this.chatForm = document.getElementById('chat-form');
                this.chatInput = document.getElementById('chat-input');
                this.contactForm = document.getElementById('contact-form');
                this.contactDetailsForm = document.getElementById('contact-details-form');
                this.chatIcon = document.querySelector('.chat-icon');
                this.closeIcon = document.querySelector('.close-icon');
                this.isOpen = false;
                this.userInfo = {
                    name: '',
                    email: '',
                    company: '',
                    hasProvidedInfo: false
                };
                this.messageCount = 0;
                this.shouldPromptForInfo = true;
                this.contactCollection = {
                    active: false,
                    step: 'none', // 'name', 'email', 'done'
                    name: '',
                    email: ''
                };
                // WARNING: API keys in client-side code are visible to users
                // For production, use server-side proxy or serverless functions
                this.apiKey = '{{ site.openai_api_key }}' || '{{ site.claude_api_key }}';
                this.apiProvider = '{{ site.ai_provider | default: "openai" }}';

                this.init();
            }

            init() {
                this.chatToggle.addEventListener('click', () => this.toggleChat());
                this.chatForm.addEventListener('submit', (e) => this.handleSubmit(e));
                this.contactDetailsForm.addEventListener('submit', (e) => this.handleContactSubmit(e));

                // Quick question buttons
                document.addEventListener('click', (e) => {
                    if (e.target.classList.contains('quick-question')) {
                        const question = e.target.dataset.question;
                        this.sendMessage(question);
                    }
                });

                // ESC key to close
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && this.isOpen) {
                        this.toggleChat();
                    }
                });
            }

            async handleContactSubmit(e) {
                e.preventDefault();

                const name = document.getElementById('user-name').value.trim();
                const email = document.getElementById('user-email').value.trim();
                const company = document.getElementById('user-company').value.trim();

                if (!name || !email) {
                    this.addMessage("Please provide both your name and email to continue.", 'bot');
                    return;
                }

                // Store user info
                this.userInfo = {
                    name: name,
                    email: email,
                    company: company,
                    hasProvidedInfo: true
                };

                // Submit to your contact form system
                await this.submitToContactForm(name, email, company);

                // Hide contact form and show success message
                this.contactForm.style.display = 'none';
                this.chatForm.style.display = 'block';

                this.addMessage(`Thanks ${name}! I've connected you with our team. They'll follow up with personalized automation recommendations for ${company || 'your business'}. In the meantime, feel free to ask me anything else!`, 'bot');

                this.shouldPromptForInfo = false;
            }

            async submitToContactForm(name, email, company) {
                try {
                    // Submit to Formspree (your existing contact form endpoint)
                    const formData = new FormData();
                    formData.append('name', name);
                    formData.append('email', email);
                    formData.append('company', company || '');
                    formData.append('interest', 'ai-integration'); // Default service
                    formData.append('message', `Chat widget lead: ${name} from ${company || 'their company'} is interested in AI automation. Email: ${email}`);
                    formData.append('_subject', 'New Chat Widget Lead - Abba Baba');

                    await fetch('https://formspree.io/f/xblzywnn', {
                        method: 'POST',
                        body: formData,
                        headers: {
                            'Accept': 'application/json'
                        }
                    });
                } catch (error) {
                    console.error('Failed to submit contact form:', error);
                    // Continue anyway - we still have their info in the chat
                }
            }

            skipContactForm() {
                this.contactForm.style.display = 'none';
                this.chatForm.style.display = 'block';
                this.shouldPromptForInfo = false;
                this.addMessage("No problem! Feel free to continue our conversation. If you'd like personalized recommendations later, just let me know!", 'bot');
            }

            showContactForm() {
                // Only show contact form if chat form is currently visible
                if (this.chatForm.style.display !== 'none') {
                    this.contactForm.style.display = 'block';
                    this.chatForm.style.display = 'none';
                }
            }

            ensureChatFormVisible() {
                // Safety method to ensure chat form is always visible
                if (this.chatForm.style.display === 'none' && this.contactForm.style.display === 'none') {
                    this.chatForm.style.display = 'block';
                }
            }

            startSimpleContactCollection() {
                if (!this.contactCollection.active && !this.userInfo.hasProvidedInfo) {
                    this.contactCollection.active = true;
                    this.contactCollection.step = 'name';
                    this.shouldPromptForInfo = false;

                    this.addMessage("I'd love to send you some personalized recommendations! üòä What's your first name?", 'bot');
                }
            }

            handleContactCollection(message) {
                if (!this.contactCollection.active) return false;

                const trimmedMessage = message.trim();

                if (this.contactCollection.step === 'name') {
                    this.contactCollection.name = trimmedMessage;
                    this.contactCollection.step = 'email';
                    this.addMessage(`Nice to meet you, ${trimmedMessage}! üëã What's your email address so I can send you those recommendations?`, 'bot');
                    return true;
                } else if (this.contactCollection.step === 'email') {
                    // Simple email validation
                    if (trimmedMessage.includes('@') && trimmedMessage.includes('.')) {
                        this.contactCollection.email = trimmedMessage;
                        this.contactCollection.step = 'done';
                        this.contactCollection.active = false;

                        // Submit to contact form
                        this.submitSimpleContact(this.contactCollection.name, this.contactCollection.email);

                        this.addMessage(`Perfect! Thanks ${this.contactCollection.name}! üöÄ I'll send personalized automation recommendations to ${trimmedMessage}. Our team will follow up with you soon!\n\nIn the meantime, feel free to ask me anything else!`, 'bot');

                        this.userInfo.hasProvidedInfo = true;
                        return true;
                    } else {
                        this.addMessage("That doesn't look like a valid email address. Could you please share your email? (example: you@company.com)", 'bot');
                        return true;
                    }
                }

                return false;
            }

            async submitSimpleContact(name, email) {
                try {
                    const formData = new FormData();
                    formData.append('name', name);
                    formData.append('email', email);
                    formData.append('interest', 'Simple Chat Collection');
                    formData.append('_subject', 'Simple Chat Contact Collection - Abba Baba');

                    await fetch('https://formspree.io/f/xblzywnn', {
                        method: 'POST',
                        body: formData
                    });
                } catch (error) {
                    console.error('Failed to submit simple contact:', error);
                }
            }

            toggleChat() {
                this.isOpen = !this.isOpen;

                if (this.isOpen) {
                    this.chatWindow.style.display = 'flex';
                    this.chatIcon.style.display = 'none';
                    this.closeIcon.style.display = 'block';
                    this.chatInput.focus();
                } else {
                    this.chatWindow.style.display = 'none';
                    this.chatIcon.style.display = 'block';
                    this.closeIcon.style.display = 'none';
                }
            }

            async handleSubmit(e) {
                e.preventDefault();
                const message = this.chatInput.value.trim();
                if (!message) return;

                this.sendMessage(message);
            }

            async sendMessage(message) {
                // Disable form to prevent multiple submissions
                const sendButton = this.chatForm.querySelector('.chat-send');
                const originalButtonHTML = sendButton.innerHTML;

                sendButton.disabled = true;
                sendButton.innerHTML = `
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <path d="M12 6v6l4 2"></path>
                    </svg>
                `;

                // Add user message and force scroll to bottom (user initiated action)
                this.addMessage(message, 'user');
                this.forceScrollToBottom();
                this.chatInput.value = '';
                this.messageCount++;

                // Check if we're in contact collection mode
                if (this.handleContactCollection(message)) {
                    // Contact collection handled the message, no need for AI response
                    sendButton.disabled = false;
                    sendButton.innerHTML = originalButtonHTML;
                    this.chatInput.focus();
                    this.ensureChatFormVisible();
                    return;
                }

                // Show typing indicator
                const typingId = this.addTypingIndicator();

                try {
                    const response = await this.callAI(message);
                    this.removeMessage(typingId);
                    this.addMessage(response, 'bot');

                    // Always scroll to bottom for new messages
                    setTimeout(() => this.scrollToBottom(), 100);

                    // After 3+ messages, offer simple contact collection
                    if (this.messageCount >= 3 && this.shouldPromptForInfo && !this.userInfo.hasProvidedInfo) {
                        const lowerMessage = message.toLowerCase();

                        // Check if they're showing interest in services (simple trigger)
                        if (lowerMessage.includes('consultation') || lowerMessage.includes('get started') ||
                            lowerMessage.includes('pricing') || lowerMessage.includes('cost') ||
                            lowerMessage.includes('services') || lowerMessage.includes('help me')) {

                            setTimeout(() => {
                                this.startSimpleContactCollection();
                            }, 1500);
                        }
                    }
                } catch (error) {
                    console.error('Chat error:', error);
                    this.removeMessage(typingId);

                    // More specific error message based on the error type
                    let errorMessage = "I'm having trouble connecting right now. ";
                    if (error.message.includes('timeout')) {
                        errorMessage += "The request timed out. ";
                    } else if (error.message.includes('CORS')) {
                        errorMessage += "There's a connection issue. ";
                    }
                    errorMessage += "Please try again or contact us directly through our contact page.";

                    this.addMessage(errorMessage, 'bot');
                } finally {
                    // Always re-enable the button and restore original state
                    sendButton.disabled = false;
                    sendButton.innerHTML = originalButtonHTML;
                    this.chatInput.focus();

                    // Safety check to ensure chat form is visible
                    this.ensureChatFormVisible();
                }
            }

            async callAI(message) {
                // Use real API if key is available, otherwise fallback to contextual responses
                if (this.apiKey && this.apiKey !== '' && this.apiKey.length > 10) {
                    try {
                        console.log('Attempting API call with provider:', this.apiProvider);

                        // Add timeout to prevent hanging
                        const timeoutPromise = new Promise((_, reject) =>
                            setTimeout(() => reject(new Error('Request timeout')), 15000)
                        );

                        let apiCall;
                        if (this.apiProvider === 'openai') {
                            apiCall = this.callOpenAI(message);
                        } else if (this.apiProvider === 'claude') {
                            apiCall = this.callClaude(message);
                        } else {
                            throw new Error('Unknown API provider');
                        }

                        const result = await Promise.race([apiCall, timeoutPromise]);
                        console.log('API call successful');
                        return result;
                    } catch (error) {
                        console.error('API call failed:', error);
                        console.log('Falling back to contextual response');
                        // Fallback to contextual response
                    }
                } else {
                    console.log('No API key available, using contextual responses');
                }
                return this.getContextualResponse(message);
            }

            async callOpenAI(message) {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 30000); // 30 second timeout

                try {
                    const response = await fetch('https://api.openai.com/v1/chat/completions', {
                        method: 'POST',
                        signal: controller.signal,
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${this.apiKey}`
                        },
                    body: JSON.stringify({
                        model: 'gpt-3.5-turbo',
                        messages: [
                            {
                                role: 'system',
                                content: `You are Abba AI, representing Abba Baba's enterprise AI-human collaboration solutions. You communicate with C-level executives, VPs, and senior decision-makers considering strategic automation investments.

Company Overview:
- Abba Baba delivers enterprise AI-human collaboration solutions with measurable ROI
- Typical engagements: $50k+ strategic automation implementations
- Focus: Operational efficiency, cost reduction, competitive advantage through intelligent automation

Key Services:
1. Workflow Automation - 30-40% operational cost reduction, proven ROI within 90 days
2. Marketing Automation - 3x conversion rate improvements, scalable customer engagement
3. AI Integration - Strategic implementation with quality assurance and business impact measurement
4. Mycelium Network - Cross-departmental intelligence eliminating silos, 40% faster decision-making
5. Riddlen Platform - Enterprise AI validation network, blockchain-based quality assurance

Value Proposition:
- Average client savings: $50-200k annually per automated workflow
- Time recovery: 20-35 hours weekly per executive
- ROI timeline: Positive returns within 3-6 months
- Quality metrics: 50% reduction in error rates

Communication Style: Professional, data-driven, ROI-focused. Lead with metrics, business impact, and strategic value. Avoid overly casual language. Focus on business outcomes, efficiency gains, and competitive advantages.

Always guide conversations toward discovery calls and business assessments. Qualify prospects by understanding their operational challenges and automation maturity.`
                            },
                            {
                                role: 'user',
                                content: message
                            }
                        ],
                        max_tokens: 300,
                        temperature: 0.7
                    })
                });

                    clearTimeout(timeoutId);

                    if (!response.ok) {
                        const errorText = await response.text();
                        console.error('OpenAI API Error:', response.status, errorText);
                        throw new Error(`API request failed: ${response.status}`);
                    }

                    const data = await response.json();
                    return data.choices[0].message.content;
                } catch (error) {
                    clearTimeout(timeoutId);
                    console.error('OpenAI API call failed:', error);
                    throw error;
                }
            }

            async callClaude(message) {
                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${this.apiKey}`,
                        'anthropic-version': '2023-06-01'
                    },
                    body: JSON.stringify({
                        model: 'claude-3-haiku-20240307',
                        max_tokens: 300,
                        system: `You are Abba AI, representing Abba Baba's enterprise AI-human collaboration solutions. You communicate with C-level executives, VPs, and senior decision-makers considering strategic automation investments.

Company Overview:
- Abba Baba delivers enterprise AI-human collaboration solutions with measurable ROI
- Typical engagements: $50k+ strategic automation implementations
- Focus: Operational efficiency, cost reduction, competitive advantage through intelligent automation

Key Services:
1. Workflow Automation - 30-40% operational cost reduction, proven ROI within 90 days
2. Marketing Automation - 3x conversion rate improvements, scalable customer engagement
3. AI Integration - Strategic implementation with quality assurance and business impact measurement
4. Mycelium Network - Cross-departmental intelligence eliminating silos, 40% faster decision-making
5. Riddlen Platform - Enterprise AI validation network, blockchain-based quality assurance

Value Proposition:
- Average client savings: $50-200k annually per automated workflow
- Time recovery: 20-35 hours weekly per executive
- ROI timeline: Positive returns within 3-6 months
- Quality metrics: 50% reduction in error rates

Communication Style: Professional, data-driven, ROI-focused. Lead with metrics, business impact, and strategic value. Avoid overly casual language. Focus on business outcomes, efficiency gains, and competitive advantages.

Always guide conversations toward discovery calls and business assessments. Qualify prospects by understanding their operational challenges and automation maturity.`,
                        messages: [
                            {
                                role: 'user',
                                content: message
                            }
                        ]
                    })
                });

                if (!response.ok) {
                    throw new Error('API request failed');
                }

                const data = await response.json();
                return data.content[0].text;
            }

            getContextualResponse(message) {
                const lowerMessage = message.toLowerCase();

                if (lowerMessage.includes('service') || lowerMessage.includes('what do you do') || lowerMessage.includes('help my business') || lowerMessage.includes('transform my business')) {
                    return "Abba Baba specializes in enterprise AI-human collaboration solutions that deliver measurable ROI. Our core offerings:\n\n**üìä Workflow Automation** - Reduce operational costs by 30-40% while improving accuracy\n**üéØ Marketing Automation** - Scale customer engagement with 3x conversion rates\n**üîó AI Integration** - Strategic AI implementation with clear business impact\n**üåê Mycelium Network** - Cross-departmental data intelligence for faster decision-making\n**‚ö° Riddlen Platform** - Enterprise-grade AI validation network\n\nTypical client outcomes include 20-35 hour weekly time savings and $50k+ annual cost reductions.\n\nWhich area represents your biggest operational challenge?";
                }

                if (lowerMessage.includes('mycelium') || lowerMessage.includes('network') || lowerMessage.includes('living ai')) {
                    return "Mycelium is our proprietary cross-departmental intelligence network that eliminates organizational silos.\n\n**Key Benefits:**\n- **Real-time data flow** between sales, marketing, operations, and support\n- **Decision velocity** increased by 40% through contextual information sharing\n- **Customer lifetime value** improved by 25% via unified customer intelligence\n- **Operational efficiency** gains of 30% through automated inter-departmental workflows\n\n**Technical Implementation:**\nAPI-driven integration with existing systems, machine learning for pattern recognition, and automated workflow triggers based on cross-departmental events.\n\nWhat's your current biggest challenge with departmental coordination?";
                }

                if (lowerMessage.includes('riddlen') || lowerMessage.includes('web3')) {
                    return "Riddlen demonstrates our enterprise AI validation capabilities through a Web3 platform where AI generation meets human verification.\n\n**Enterprise Applications:**\n- **Data validation** networks for critical business decisions\n- **Content quality** assurance at scale\n- **Distributed verification** systems for compliance and accuracy\n- **Cross-chain oracle** infrastructure for enterprise blockchain integration\n\n**Technical Specs:**\n- Gasless blockchain transactions\n- Multi-chain compatibility\n- Enterprise-grade security protocols\n- Scalable validation networks\n\nThis same technology can validate your business-critical AI outputs. Are you looking to implement AI with quality assurance requirements?";
                }

                if (lowerMessage.includes('collaboration') || lowerMessage.includes('ai human') || lowerMessage.includes('partnership')) {
                    return "AI-human collaboration drives measurable business outcomes by optimizing the strengths of both:\n\n**AI Capabilities:** Data processing, pattern recognition, 24/7 availability, consistent execution\n**Human Oversight:** Strategic thinking, quality control, creative problem-solving, relationship management\n\n**ROI Metrics:**\n- **Cost reduction:** 35% average decrease in operational expenses\n- **Quality improvement:** 50% reduction in error rates\n- **Speed to market:** 40% faster project delivery\n- **Employee satisfaction:** 30% improvement through elimination of repetitive tasks\n\nCompanies implementing this approach typically see positive ROI within 90 days.\n\nWhat's your current automation maturity level?";
                }

                if (lowerMessage.includes('automation') || lowerMessage.includes('wins') || lowerMessage.includes('success') || lowerMessage.includes('roi') || lowerMessage.includes('results')) {
                    return "Our enterprise automation implementations deliver quantifiable results:\n\n**Financial Impact:**\n- Average 35% reduction in operational costs\n- $50-200k annual savings per automated workflow\n- ROI typically achieved within 3-6 months\n- 40% improvement in process efficiency\n\n**Operational Metrics:**\n- 20-35 hours weekly time recovery per executive\n- 50% reduction in manual error rates\n- 60% faster customer response times\n- 3x increase in lead conversion rates\n\n**Strategic Outcomes:**\n- Scalable growth without proportional headcount increases\n- Data-driven decision making capabilities\n- Competitive advantage through operational excellence\n\nWhat metrics would be most impactful for your organization?";
                }

                if (lowerMessage.includes('contact') || lowerMessage.includes('consultation') || lowerMessage.includes('get started') || lowerMessage.includes('interested') || lowerMessage.includes('pricing') || lowerMessage.includes('cost')) {
                    return "I'd be happy to connect you with our enterprise solutions team.\n\n**Discovery Process:**\n1. **Business Assessment** (30 min) - Current state analysis and automation opportunities\n2. **ROI Projection** - Quantified impact analysis with specific metrics\n3. **Implementation Roadmap** - Phased approach with timeline and deliverables\n4. **Pilot Program** - Low-risk proof of concept with measurable outcomes\n\n**What You'll Receive:**\n- Detailed automation opportunity analysis\n- Custom ROI projections and timeline\n- Technical implementation plan\n- Investment requirements and expected returns\n\nOur typical engagement starts with a strategic assessment. Would you prefer to schedule a discovery call or receive a detailed capabilities overview first?";
                }

                // Default response
                return `I'm here to help you understand how Abba Baba's AI-human collaboration solutions can drive measurable business value for your organization.\n\n**Core Focus Areas:**\n- Enterprise workflow automation with proven ROI\n- Cross-departmental intelligence networks\n- Strategic AI integration with quality assurance\n- Scalable automation solutions for growing businesses\n\n**Typical Results:** 30-40% cost reduction, 20+ hour weekly time savings, positive ROI within 90 days.\n\nWhat specific business challenges are you looking to address? I can provide relevant case studies and implementation approaches.`;
            }

            addMessage(content, type) {
                const messageId = 'msg-' + Date.now();
                const messageEl = document.createElement('div');
                messageEl.id = messageId;
                messageEl.className = `message ${type}-message`;

                messageEl.innerHTML = `
                    <div class="message-content">
                        <div>${this.formatMessage(content)}</div>
                    </div>
                `;

                this.chatMessages.appendChild(messageEl);
                this.scrollToBottom();
                return messageId;
            }

            addTypingIndicator() {
                const typingId = 'typing-' + Date.now();
                const typingEl = document.createElement('div');
                typingEl.id = typingId;
                typingEl.className = 'message bot-message typing';

                typingEl.innerHTML = `
                    <div class="message-content">
                        <div class="typing-indicator">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                    </div>
                `;

                this.chatMessages.appendChild(typingEl);
                this.scrollToBottom();
                return typingId;
            }

            removeMessage(messageId) {
                const messageEl = document.getElementById(messageId);
                if (messageEl) {
                    messageEl.remove();
                }
            }

            shouldAutoScroll() {
                // Check if user is near the bottom (within 100px)
                const scrollTop = this.chatMessages.scrollTop;
                const scrollHeight = this.chatMessages.scrollHeight;
                const clientHeight = this.chatMessages.clientHeight;
                return scrollTop + clientHeight >= scrollHeight - 100;
            }

            scrollToBottom() {
                // Always scroll to bottom for chatbot behavior
                requestAnimationFrame(() => {
                    this.chatMessages.scrollTop = this.chatMessages.scrollHeight;
                });
            }

            forceScrollToBottom() {
                // Force scroll to bottom immediately
                this.chatMessages.scrollTop = this.chatMessages.scrollHeight;
            }

            formatMessage(content) {
                // Convert common markdown to HTML for better readability
                return content
                    // Bold text: **text** or __text__
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    .replace(/__(.*?)__/g, '<strong>$1</strong>')
                    // Italic text: *text* or _text_
                    .replace(/\*(.*?)\*/g, '<em>$1</em>')
                    .replace(/_(.*?)_/g, '<em>$1</em>')
                    // Code blocks: ```code```
                    .replace(/```([\s\S]*?)```/g, '<pre><code>$1</code></pre>')
                    // Inline code: `code`
                    .replace(/`([^`]+)`/g, '<code>$1</code>')
                    // Line breaks
                    .replace(/\n/g, '<br>')
                    // Links: [text](url)
                    .replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank" rel="noopener">$1</a>')
                    // Lists: - item or * item
                    .replace(/^[*-]\s+(.+)$/gm, '<li>$1</li>')
                    .replace(/(<li>.*<\/li>)/s, '<ul>$1</ul>');
            }
        }

        // Initialize chat widget when DOM is loaded
        let AbbaChat;
        document.addEventListener('DOMContentLoaded', function() {
            AbbaChat = new AbbaAIChat();
        });
    </script>

    <script src="{{ '/assets/js/main.js' | relative_url }}"></script>
</body>
</html>