{% comment %}
Site Navigation Flow - Creates a guided walkthrough experience
Provides contextual next/previous navigation between key pages
Dynamically builds navigation from site.header_pages configuration

Parameters:
- current_page: Current page identifier (home, about, services, mycelium, riddlen, blog, faq, contact)
- style: "default", "minimal", "simple" (optional)

Navigation order: Home → [header_pages from _config.yml]
{% endcomment %}

{% assign current = include.current_page | default: "home" %}
{% assign nav_style = include.style | default: "default" %}

{% comment %} Build navigation flow dynamically from config {% endcomment %}
{% assign pages = "home" | split: "," %}
{% assign page_titles = "Home" | split: "," %}
{% assign page_urls = "/" | split: "," %}
{% assign page_descriptions = "Start your journey" | split: "," %}

{% comment %} Add pages from header_pages config {% endcomment %}
{% for header_page in site.header_pages %}
    {% assign page_path = header_page | remove: '.md' %}
    {% assign pages = pages | push: page_path %}
    {% assign page_url = "/" | append: page_path %}
    {% assign page_urls = page_urls | push: page_url %}

    {% comment %} Get page title from the actual page {% endcomment %}
    {% assign page_obj = site.pages | where: "path", header_page | first %}
    {% if page_obj.title %}
        {% assign page_titles = page_titles | push: page_obj.title %}
    {% else %}
        {% assign clean_title = page_path | replace: "-", " " | capitalize %}
        {% assign page_titles = page_titles | push: clean_title %}
    {% endif %}

    {% comment %} Set appropriate descriptions {% endcomment %}
    {% case page_path %}
        {% when 'about' %}
            {% assign page_descriptions = page_descriptions | push: "Learn our story" %}
        {% when 'services' %}
            {% assign page_descriptions = page_descriptions | push: "Explore solutions" %}
        {% when 'mycelium' %}
            {% assign page_descriptions = page_descriptions | push: "Discover our AI network" %}
        {% when 'riddlen' %}
            {% assign page_descriptions = page_descriptions | push: "See innovation" %}
        {% when 'blog' %}
            {% assign page_descriptions = page_descriptions | push: "Read insights" %}
        {% when 'faq' %}
            {% assign page_descriptions = page_descriptions | push: "Get answers" %}
        {% when 'contact' %}
            {% assign page_descriptions = page_descriptions | push: "Get in touch" %}
        {% else %}
            {% assign page_descriptions = page_descriptions | push: "Explore more" %}
    {% endcase %}
{% endfor %}

{% comment %} Find current page index {% endcomment %}
{% assign current_index = 0 %}
{% for page in pages %}
    {% if page == current %}
        {% assign current_index = forloop.index0 %}
        {% break %}
    {% endif %}
{% endfor %}

{% comment %} Calculate previous and next pages {% endcomment %}
{% assign prev_index = current_index | minus: 1 %}
{% assign next_index = current_index | plus: 1 %}

<div class="site-navigation-wrapper{% if nav_style != 'default' %} site-navigation-{{ nav_style }}{% endif %}">
    <nav class="site-navigation" aria-label="Site navigation flow">

        {% unless nav_style == "simple" %}
        <div class="navigation-progress">
            <div class="progress-info">
                <span class="progress-text">Step {{ current_index | plus: 1 }} of {{ pages.size }}</span>
                <span class="progress-title">{{ page_titles[current_index] }}</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" style="width: {{ current_index | plus: 1 | times: 100 | divided_by: pages.size }}%"></div>
            </div>
        </div>
        {% endunless %}

        <div class="navigation-controls">
            {% comment %} Previous Page {% endcomment %}
            {% if prev_index >= 0 %}
                <a href="{{ page_urls[prev_index] | relative_url }}" class="navigation-btn navigation-prev" rel="prev">
                    <span class="nav-arrow">←</span>
                    <div class="nav-content">
                        <span class="nav-label">Previous</span>
                        <span class="nav-title">{{ page_titles[prev_index] }}</span>
                        <span class="nav-description">{{ page_descriptions[prev_index] }}</span>
                    </div>
                </a>
            {% else %}
                <div class="navigation-btn navigation-prev navigation-disabled">
                    <span class="nav-arrow">←</span>
                    <div class="nav-content">
                        <span class="nav-label">Previous</span>
                        <span class="nav-title">Start</span>
                        <span class="nav-description">You're at the beginning</span>
                    </div>
                </div>
            {% endif %}

            {% comment %} Current Page Indicator {% endcomment %}
            {% unless nav_style == "simple" %}
            <div class="navigation-current">
                <div class="current-indicator">
                    <span class="current-step">{{ current_index | plus: 1 }}</span>
                </div>
                <div class="current-info">
                    <span class="current-title">{{ page_titles[current_index] }}</span>
                    <span class="current-description">{{ page_descriptions[current_index] }}</span>
                </div>
            </div>
            {% endunless %}

            {% comment %} Next Page {% endcomment %}
            {% if next_index < pages.size %}
                <a href="{{ page_urls[next_index] | relative_url }}" class="navigation-btn navigation-next" rel="next">
                    <div class="nav-content">
                        <span class="nav-label">Next</span>
                        <span class="nav-title">{{ page_titles[next_index] }}</span>
                        <span class="nav-description">{{ page_descriptions[next_index] }}</span>
                    </div>
                    <span class="nav-arrow">→</span>
                </a>
            {% else %}
                <div class="navigation-btn navigation-next navigation-disabled">
                    <div class="nav-content">
                        <span class="nav-label">Next</span>
                        <span class="nav-title">Complete</span>
                        <span class="nav-description">You've reached the end</span>
                    </div>
                    <span class="nav-arrow">→</span>
                </div>
            {% endif %}
        </div>

        {% comment %} Quick Jump Navigation {% endcomment %}
        {% unless nav_style == "minimal" or nav_style == "simple" %}
        <div class="navigation-overview">
            <div class="overview-title">Quick Navigation</div>
            <div class="overview-pages">
                {% for page in pages %}
                    {% assign page_index = forloop.index0 %}
                    {% if page_index == current_index %}
                        <span class="overview-page overview-current" aria-current="page">
                            {{ page_titles[page_index] }}
                        </span>
                    {% else %}
                        <a href="{{ page_urls[page_index] | relative_url }}" class="overview-page">
                            {{ page_titles[page_index] }}
                        </a>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
        {% endunless %}
    </nav>
</div>